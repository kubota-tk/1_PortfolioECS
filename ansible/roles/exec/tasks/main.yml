---
- name: Check installed session-manager-plugin
  ansible.builtin.command:
    cmd: session-manager-plugin
  register: Check_plugin
  ignore_errors: yes
  changed_when: false

- name: Install session-manager-plugin
  become: yes
  ansible.builtin.yum:
    name: "https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm"
#    return_content: yes
  when: "'The Session Manager plugin was installed successfully' not in Check_plugin"
  changed_when: false

##amazon-ssm-agent起動
- name: restart amazon-ssm-agent
  ansible.builtin.service:
    name: amazon-ssm-agent
    state: restarted
  become: yes


